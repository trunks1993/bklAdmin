webpackJsonp([2,4],{"595N":function(e,t,a){(e.exports=a("FZ+f")(!1)).push([e.i,'\n.footer[data-v-0870ae02] {\n  width: 100%;\n  padding: 20px;\n}\n.footer-priceDetail-money[data-v-0870ae02], .footer-priceDetail-qrCode[data-v-0870ae02] {\n    display: table;\n}\n.footer-priceDetail-money .title[data-v-0870ae02], .footer-priceDetail-qrCode .title[data-v-0870ae02] {\n      color: #5a5e66;\n      display: table-cell;\n      vertical-align: middle;\n}\n.footer-priceDetail-money .money[data-v-0870ae02], .footer-priceDetail-qrCode .money[data-v-0870ae02] {\n      font-size: 24px;\n      height: 24px;\n      line-height: 24px;\n      color: #f60;\n      font-family: "\\5FAE\\8F6F\\96C5\\9ED1", "Microsoft Yahei", "Hiragino Sans GB", tahoma, arial, "\\5B8B\\4F53";\n}\n.footer-submit[data-v-0870ae02] {\n    text-align: center;\n}\n',""])},"634l":function(e,t,a){var i=a("y2Wv");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a("rjj0")("6d6a5dcd",i,!0)},"78+T":function(e,t,a){e.exports=a.p+"static/img/advertDetail.ed37c88.png"},DQ7j:function(e,t,a){var i=a("e1tw");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a("rjj0")("745477fe",i,!0)},Fqtf:function(e,t,a){var i=a("595N");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a("rjj0")("00d2df50",i,!0)},FtYw:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("0xDb"),s=a("vMJZ"),r=a("Wxq9"),n=a("E4LH"),o={data:function(){return{options:r.regionData,listQuery:{current:1,size:20,condition:{user:this.$store.getters.userInfo.id}},deliveryAddress:{id:"",address:[],addressDetail:"",receiver:"",phone:"",user:this.$store.getters.userInfo.id},loading:!1,rules:{address:[{required:!0,message:"地区不能为空"}],addressDetail:[{required:!0,message:"地址详情不能为空",trigger:"blur"}],receiver:[{required:!0,message:"收货人不能为空",trigger:"blur"}],phone:[{required:!0,validator:n.c,trigger:"blur"}]},deliveryAddressList:[],show:!1}},created:function(){this.getList()},methods:{save:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;var a=_.cloneDeep(e.deliveryAddress);a.address=a.address.toString(),Object(s.v)(a).then(function(t){var a=t.data;0===a.code&&"success"===a.msg?(e.getList(),e.resetForm(),e.$notify({title:"成功",message:"创建成功",type:"success",duration:2e3})):(e.resetForm(),e.$notify.error({title:"错误",message:"最多创建5条收货地址"}))})})},getList:function(){var e=this;this.loading=!0,Object(s.j)(this.listQuery).then(function(t){var a=t.data;0===a.code&&"success"===a.msg&&(e.deliveryAddressList=a.datas.records,e.total=a.datas.total,e.loading=!1)})},deleteAddress:function(e){var t=this;this.$confirm("是否删除收货地址?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(s.g)(e).then(function(e){var a=e.data;0===a.code&&"success"===a.msg&&(t.getList(),t.$notify({title:"成功",message:"删除成功",type:"success",duration:2e3}))})})},updateAddress:function(e){var t=_.clone(e);t.address=t.address.split(","),this.deliveryAddress=t},defaultAddress:function(e){var t=this;Object(s.x)(e).then(function(e){var a=e.data;0===a.code&&"success"===a.msg&&(t.getList(),t.$notify({title:"成功",message:"设置成功",type:"success",duration:2e3}))})},resetForm:function(){this.$refs.form.resetFields()}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"deliveryAddress-container"},[a("el-form",{ref:"form",staticStyle:{width:"400px","margin-left":"50px"},attrs:{model:e.deliveryAddress,"status-icon":"",rules:e.rules,size:"small","label-position":"left","label-width":"100px"}},[a("el-form-item",{attrs:{label:"所在地区",prop:"address"}},[a("el-cascader",{attrs:{options:e.options},model:{value:e.deliveryAddress.address,callback:function(t){e.$set(e.deliveryAddress,"address",t)},expression:"deliveryAddress.address"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"详细地址",prop:"addressDetail"}},[a("el-input",{model:{value:e.deliveryAddress.addressDetail,callback:function(t){e.$set(e.deliveryAddress,"addressDetail",t)},expression:"deliveryAddress.addressDetail"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"收货人姓名",prop:"receiver"}},[a("el-input",{model:{value:e.deliveryAddress.receiver,callback:function(t){e.$set(e.deliveryAddress,"receiver",t)},expression:"deliveryAddress.receiver"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"手机号码",prop:"phone"}},[a("el-input",{model:{value:e.deliveryAddress.phone,callback:function(t){e.$set(e.deliveryAddress,"phone",t)},expression:"deliveryAddress.phone"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("保存")])],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.deliveryAddressList,border:"",fit:""}},[a("el-table-column",{attrs:{align:"center",label:"收货人"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.receiver))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"所在地区"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("formatAddress")(t.row.address)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"详细地址"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.addressDetail))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"手机号码"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.phone))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"操作",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){e.updateAddress(t.row)}}},[e._v("修改")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){e.deleteAddress(t.row.id)}}},[e._v("删除")]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:0===t.row.status,size:"mini"},nativeOn:{click:function(a){e.defaultAddress(t.row.id)}}},[e._v(e._s(0===t.row.status?"默认":"设为默认"))])]}}])})],1)],1)},staticRenderFns:[]};var d=a("VU/8")(o,l,!1,function(e){a("634l")},"data-v-5a94f395",null).exports,c=a("jYru"),v=a("EvBC"),u=a.n(v),y=a("78+T"),f=a.n(y),p={components:{DeliveryAddress:d,AdvertSelect:c.a},props:{activity:{type:Object}},data:function(){var e=this;return{listQuery:{current:1,size:20,condition:{user:this.$store.getters.userInfo.id}},rec:u.a,advertImg:f.a,pickerBeginDateBefore:{disabledDate:function(e){return e.getTime()<Date.now()}},deliveryAddressList:[],dialogDeliveryAddress:!1,rules:{name:[{required:!0,message:"请输入活动名称",trigger:"blur"}],startDate:[{required:!0,message:"请选择活动开始日期",trigger:"change"}],deliveryAddress:[{required:!0,message:"收货地址不能为空",trigger:"change"}],totalMoney:[{required:!0,validator:function(t,a,i){1!==e.activity.qrCount&&e.$refs.activity.validateField("minMoney"),a<e.activity.qrCount&&i(new Error("总金额不能小于红包个数")),i()},trigger:"blur"}],minMoney:[{required:!0,validator:function(t,a,i){a<=e.maxMinMoney&&i(),i(new Error("最小金额超出设置范围"))},trigger:"blur"}]},advert:""}},computed:{maxMinMoney:function(){return Math.floor(this.activity.totalMoney/this.activity.qrCount*100)/100}},created:function(){this.getDeliveryAddressList()},methods:{getDeliveryAddressList:function(e){var t=this;Object(s.j)(this.listQuery).then(function(a){var s=a.data;0===s.code&&"success"===s.msg&&(t.deliveryAddressList=s.datas.records,t.activity.deliveryAddress=Object(i.c)(s.datas.records),t.total=s.datas.total,e&&t.$refs.activity.validateField("deliveryAddress"),t.loading=!1)})},addDeliveryAddress:function(){this.dialogDeliveryAddress=!0},refreshAddress:function(){this.getDeliveryAddressList(!0)},minMoney_rule:function(e,t){return e===t?"设置范围：1":"设置范围：1～"+Math.floor(e/t*100)/100},checkInteger:function(e,t){var a=this.activity[t],i=this;this.$nextTick().then(function(){e%1!=0&&(i.activity[t]=a)})},checkSmallNumber:function(e,t){var a=this.activity[t],i=this;this.$nextTick().then(function(){/^\d+(\.\d{1,2})?$/.test(e)||(i.activity[t]=a)})},validateActivity:function(){var e=this;this.$refs.activity.validate(function(t){t?e.$emit("getChildValidMsg",!0):e.$emit("getChildValidMsg",!1)})}}},m={render:function(){var e=this,t=this,a=t.$createElement,i=t._self._c||a;return i("div",{staticClass:"activityForm"},[i("el-form",{ref:"activity",attrs:{model:t.activity,rules:t.rules,size:"small","label-width":"150px","label-position":"right"}},[i("div",{staticClass:"activityForm-main"},[i("div",{staticClass:"activityForm-main-title"},[i("svg-icon",{attrs:{"icon-class":"form"}}),t._v(" "),i("span",[t._v("现金红包")])],1),t._v(" "),i("div",{staticClass:"activityForm-main-item"},[i("el-form-item",{attrs:{label:"活动名称:",prop:"name"}},[i("el-col",{attrs:{span:9}},[i("el-input",{staticStyle:{width:"220px"},model:{value:t.activity.name,callback:function(e){t.$set(t.activity,"name",e)},expression:"activity.name"}})],1),t._v(" "),i("el-col",{attrs:{span:15}},[i("span",{staticClass:"form-item-span"})])],1),t._v(" "),i("el-form-item",{attrs:{label:"活动开始时间:",prop:"startDate"}},[i("el-col",{attrs:{span:9}},[i("el-date-picker",{attrs:{"picker-options":t.pickerBeginDateBefore,type:"datetime",placeholder:"选择日期时间"},model:{value:t.activity.startDate,callback:function(e){t.$set(t.activity,"startDate",e)},expression:"activity.startDate"}})],1),t._v(" "),i("el-col",{attrs:{span:15}},[t._v("二维码制作配送需要3～5天，建议提前5天发布活动信息")])],1),t._v(" "),i("el-form-item",{attrs:{label:"二维码收货地址:",prop:"deliveryAddress"}},[i("el-col",{attrs:{span:9}},[t._l(t.deliveryAddressList,function(e,a){return i("div",[i("el-radio",{attrs:{label:t._f("formatAddress")(e.address)+e.addressDetail+" ( "+e.receiver+" 收) "+e.phone},model:{value:t.activity.deliveryAddress,callback:function(e){t.$set(t.activity,"deliveryAddress",e)},expression:"activity.deliveryAddress"}},[t._v("\n                "+t._s(t._f("formatAddress")(e.address)+e.addressDetail+" ( "+e.receiver+" 收) "+e.phone)+"\n              ")])],1)}),t._v(" "),i("el-button",{attrs:{type:"text"},nativeOn:{click:function(e){t.addDeliveryAddress(e)}}},[t._v(t._s(t.deliveryAddressList.length>0?"管理收货地址":"添加收货地址"))])],2)],1),t._v(" "),i("el-form-item",{attrs:{label:"是否需要分享广告："}},[i("el-col",{attrs:{span:9}},[i("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949","active-value":0,"inactive-value":1},model:{value:t.activity.needShare,callback:function(e){t.$set(t.activity,"needShare",e)},expression:"activity.needShare"}}),t._v(" "),i("transition",{attrs:{name:"fade"}},[i("advert-select",{directives:[{name:"show",rawName:"v-show",value:!t.activity.needShare,expression:"!activity.needShare"}],model:{value:t.activity.advert,callback:function(e){t.$set(t.activity,"advert",e)},expression:"activity.advert"}})],1)],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"限制扫码次数："}},[i("el-col",{attrs:{span:9}},[i("el-input-number",{attrs:{min:1},on:{change:function(e){t.checkInteger(e,"scanedTimes")}},model:{value:t.activity.scanedTimes,callback:function(e){t.$set(t.activity,"scanedTimes",e)},expression:"activity.scanedTimes"}})],1),t._v(" "),i("el-col",{attrs:{span:15}},[t._v("限制本次活动每个微信号可扫码的次数")])],1),t._v(" "),i("el-form-item",{attrs:{label:"二维码数(红包数)："}},[i("el-col",{attrs:{span:9}},[i("el-input-number",{attrs:{min:1,controls:!1},on:{blur:function(){1!==e.activity.qrCount&&e.$refs.activity.validateField("minMoney"),e.$refs.activity.validateField("totalMoney")},change:function(e){t.checkInteger(e,"qrCount")}},model:{value:t.activity.qrCount,callback:function(e){t.$set(t.activity,"qrCount",e)},expression:"activity.qrCount"}})],1),t._v(" "),i("el-col",{attrs:{span:15}},[t._v("一个二维码对应一个红包")])],1),t._v(" "),i("el-form-item",{attrs:{label:"红包总金额：",prop:"totalMoney"}},[i("el-col",{attrs:{span:9}},[i("el-input-number",{staticClass:"gold",attrs:{min:1,controls:!1},on:{change:function(e){t.checkSmallNumber(e,"totalMoney")}},model:{value:t.activity.totalMoney,callback:function(e){t.$set(t.activity,"totalMoney",e)},expression:"activity.totalMoney"}}),t._v(" "),i("span",{staticStyle:{color:"#4fc08d","font-size":"13px"}},[t._v("微信手续费："+t._s(t._f("mathCeil")(t.activity.totalMoney)))])],1),t._v(" "),i("el-col",{attrs:{span:15}},[t._v("微信限制，单个红包金额不能少于1元")])],1),t._v(" "),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:1!==t.activity.qrCount,expression:"activity.qrCount !== 1"}],attrs:{label:"最小金额：",prop:"minMoney"}},[i("el-col",{attrs:{span:9}},[i("el-input-number",{staticClass:"gold",attrs:{min:1,max:t.maxMinMoney,controls:!1},on:{change:function(e){t.checkSmallNumber(e,"minMoney")}},model:{value:t.activity.minMoney,callback:function(e){t.$set(t.activity,"minMoney",e)},expression:"activity.minMoney"}}),t._v(" "),i("span",{staticStyle:{color:"#4fc08d","font-size":"13px"}},[t._v(t._s(t.minMoney_rule(t.activity.totalMoney,t.activity.qrCount)))])],1),t._v(" "),i("el-col",{attrs:{span:15}},[t._v("设置不超过设置范围的数，可包含两位小数")])],1)],1)])]),t._v(" "),i("el-dialog",{attrs:{title:"管理收货地址",visible:t.dialogDeliveryAddress},on:{"update:visible":function(e){t.dialogDeliveryAddress=e},close:t.refreshAddress}},[t.dialogDeliveryAddress?i("delivery-address"):t._e()],1)],1)},staticRenderFns:[]};var g=a("VU/8")(p,m,!1,function(e){a("w1rV"),a("DQ7j")},"data-v-211ee57a",null);t.default=g.exports},NWtz:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("Dd8w"),s=a.n(i),r=a("FtYw"),n=a("Ty/O"),o=a("XbCK"),l=a("NYxO"),d=a("vMJZ"),c=a("qsgq"),v=a.n(c),u={components:{PayPage:o.a,CashRedPocket:r.default},computed:s()({},Object(l.b)(["userInfo"])),data:function(){return{createLoading:!1,activity:{user:this.$store.getters.userInfo.id,name:"",startDate:"",deliveryAddress:"",qrCount:1,totalMoney:1,minMoney:0,maxMoney:0,type:1,needShare:0,advert:"",scanedTimes:1},qrTotalPrice:0,checkstandLogo:v.a,dialogPay:!1,order:null}},created:function(){this.getCharegeQrPrice()},watch:{"activity.qrCount":{handler:function(e){this.getCharegeQrPrice()},deep:!0}},methods:{getCharegeQrPrice:function(){var e=this,t=this.activity.qrCount-this.userInfo.vo.stock;Object(d.o)(this.userInfo.id,t>0?t:0).then(function(t){e.qrTotalPrice=t.data.data})},submitForm:function(){this.$refs.cashRedPocket.validateActivity()},getChildValidMsg:function(e){var t=this;if(e){this.createLoading=!0;var a=_.cloneDeep(this.activity);a.totalMoney*=100,a.minMoney*=100,a.startDate=a.startDate.getTime(),Object(n.b)(a).then(function(e){var a=e.data;0===a.code&&"success"===a.msg&&(t.order=a.data,t.dialogPay=!0,t.createLoading=!1)})}else this.$message({message:"提交有误，请检查活动信息",type:"warning"})},getPayRes:function(e){"PAY_SUCCESS"===e?this.$router.push({path:"/activity/index"}):(this.$router.push({path:"/trade/order"}),this.$message({showClose:!0,message:"支付失败",type:"warning"}))}}},y={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"activity"},[a("el-tabs",{attrs:{type:"border-card"}},[a("el-tab-pane",{attrs:{label:"一码一扫"}},[a("cash-red-pocket",{directives:[{name:"loading",rawName:"v-loading",value:e.createLoading,expression:"createLoading"}],ref:"cashRedPocket",attrs:{activity:e.activity},on:{getChildValidMsg:e.getChildValidMsg}})],1),e._v(" "),a("el-tab-pane",{attrs:{disabled:"",label:"一码多扫(暂未上线)"}}),e._v(" "),a("div",{staticClass:"footer"},[a("div",{staticClass:"footer-priceDetail"},[a("div",{staticClass:"footer-priceDetail-money"},[a("span",{staticClass:"title"},[e._v("红包总金额：")]),e._v(" "),a("span",{staticClass:"money"},[e._v(" ¥"+e._s(e.activity.totalMoney))])]),e._v(" "),a("div",{staticClass:"footer-priceDetail-qrCode"},[a("span",{staticClass:"title"},[e._v("微信手续费：")]),e._v(" "),a("span",{staticClass:"money"},[e._v("¥"+e._s(e._f("mathCeil")(e.activity.totalMoney)))])]),e._v(" "),e.userInfo.vo.stock<e.activity.qrCount?a("div",{staticClass:"footer-priceDetail-qrCode"},[a("span",{staticClass:"title"},[e._v("二维码金额：")]),e._v(" "),a("span",{staticClass:"money"},[e._v("¥"+e._s(e.qrTotalPrice/100))])]):e._e()]),e._v(" "),a("div",{staticClass:"footer-submit"},[a("el-button",{attrs:{type:"primary",loading:e.createLoading},on:{click:e.submitForm}},[e._v("\n          ¥"+e._s(e._f("orderPrice")(e.activity.totalMoney,e.qrTotalPrice))+" 提交订单\n        ")])],1)])],1),e._v(" "),a("el-dialog",{staticClass:"pay-dialog",attrs:{visible:e.dialogPay},on:{"update:visible":function(t){e.dialogPay=t},close:e.getPayRes}},[a("div",{staticClass:"dialog-title",attrs:{slot:"title"},slot:"title"},[a("img",{attrs:{src:e.checkstandLogo}}),e._v(" "),a("span",[e._v("收银台")])]),e._v(" "),e.dialogPay?a("pay-page",{attrs:{order:e.order},on:{payRes:e.getPayRes}}):e._e()],1)],1)},staticRenderFns:[]};var f=a("VU/8")(u,y,!1,function(e){a("Fqtf")},"data-v-0870ae02",null);t.default=f.exports},TThK:function(e,t,a){(e.exports=a("FZ+f")(!1)).push([e.i,"\n.activityForm-main[data-v-211ee57a] {\n  display: table;\n  width: 100%;\n  background: #fff;\n  margin-bottom: 0;\n  padding: 40px 0 20px 0;\n  border-bottom: 1px solid #eee;\n}\n.activityForm-main-title[data-v-211ee57a] {\n    display: table-cell;\n    width: 160px;\n    padding: 0;\n    font-size: 14px;\n    font-weight: bold;\n    background: #fff;\n    color: #333;\n    text-align: center;\n    vertical-align: top;\n    position: relative;\n    top: 7px;\n}\n.activityForm-main .question-detail[data-v-211ee57a]:hover {\n    color: #4fc08d;\n    cursor: pointer;\n}\n.activityForm-main-item[data-v-211ee57a] {\n    display: table-cell;\n}\n.activityForm-main-delete[data-v-211ee57a] {\n    width: 160px;\n    text-align: center;\n}\n",""])},e1tw:function(e,t,a){(e.exports=a("FZ+f")(!1)).push([e.i,"\n.gold .el-input input {\n  color: #f90 !important;\n  font-weight: bolder !important;\n}\n",""])},w1rV:function(e,t,a){var i=a("TThK");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a("rjj0")("3199d4a2",i,!0)},y2Wv:function(e,t,a){(e.exports=a("FZ+f")(!1)).push([e.i,"\n.deliveryAddress-container[data-v-5a94f395] {\n  padding: 20px;\n}\n",""])}});