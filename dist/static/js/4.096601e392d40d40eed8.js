webpackJsonp([4],{"634l":function(e,t,i){var s=i("y2Wv");"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);i("rjj0")("6d6a5dcd",s,!0)},"78+T":function(e,t,i){e.exports=i.p+"static/img/advertDetail.ed37c88.png"},DQ7j:function(e,t,i){var s=i("e1tw");"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);i("rjj0")("745477fe",s,!0)},FtYw:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("0xDb"),a=i("vMJZ"),r=i("Wxq9"),n=i("E4LH"),l={data:function(){return{options:r.regionData,listQuery:{current:1,size:20,condition:{user:this.$store.getters.userInfo.id}},deliveryAddress:{id:"",address:[],addressDetail:"",receiver:"",phone:"",user:this.$store.getters.userInfo.id},loading:!1,rules:{address:[{required:!0,message:"地区不能为空"}],addressDetail:[{required:!0,message:"地址详情不能为空",trigger:"blur"}],receiver:[{required:!0,message:"收货人不能为空",trigger:"blur"}],phone:[{required:!0,validator:n.c,trigger:"blur"}]},deliveryAddressList:[],show:!1}},created:function(){this.getList()},methods:{save:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;var i=_.cloneDeep(e.deliveryAddress);i.address=i.address.toString(),Object(a.v)(i).then(function(t){var i=t.data;0===i.code&&"success"===i.msg?(e.getList(),e.resetForm(),e.$notify({title:"成功",message:"创建成功",type:"success",duration:2e3})):(e.resetForm(),e.$notify.error({title:"错误",message:"最多创建5条收货地址"}))})})},getList:function(){var e=this;this.loading=!0,Object(a.j)(this.listQuery).then(function(t){var i=t.data;0===i.code&&"success"===i.msg&&(e.deliveryAddressList=i.datas.records,e.total=i.datas.total,e.loading=!1)})},deleteAddress:function(e){var t=this;this.$confirm("是否删除收货地址?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(a.g)(e).then(function(e){var i=e.data;0===i.code&&"success"===i.msg&&(t.getList(),t.$notify({title:"成功",message:"删除成功",type:"success",duration:2e3}))})})},updateAddress:function(e){var t=_.clone(e);t.address=t.address.split(","),this.deliveryAddress=t},defaultAddress:function(e){var t=this;Object(a.x)(e).then(function(e){var i=e.data;0===i.code&&"success"===i.msg&&(t.getList(),t.$notify({title:"成功",message:"设置成功",type:"success",duration:2e3}))})},resetForm:function(){this.$refs.form.resetFields()}}},o={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"deliveryAddress-container"},[i("el-form",{ref:"form",staticStyle:{width:"400px","margin-left":"50px"},attrs:{model:e.deliveryAddress,"status-icon":"",rules:e.rules,size:"small","label-position":"left","label-width":"100px"}},[i("el-form-item",{attrs:{label:"所在地区",prop:"address"}},[i("el-cascader",{attrs:{options:e.options},model:{value:e.deliveryAddress.address,callback:function(t){e.$set(e.deliveryAddress,"address",t)},expression:"deliveryAddress.address"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"详细地址",prop:"addressDetail"}},[i("el-input",{model:{value:e.deliveryAddress.addressDetail,callback:function(t){e.$set(e.deliveryAddress,"addressDetail",t)},expression:"deliveryAddress.addressDetail"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"收货人姓名",prop:"receiver"}},[i("el-input",{model:{value:e.deliveryAddress.receiver,callback:function(t){e.$set(e.deliveryAddress,"receiver",t)},expression:"deliveryAddress.receiver"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"手机号码",prop:"phone"}},[i("el-input",{model:{value:e.deliveryAddress.phone,callback:function(t){e.$set(e.deliveryAddress,"phone",t)},expression:"deliveryAddress.phone"}})],1),e._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("保存")])],1)],1),e._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.deliveryAddressList,border:"",fit:""}},[i("el-table-column",{attrs:{align:"center",label:"收货人"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.receiver))])]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"所在地区"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(e._f("formatAddress")(t.row.address)))])]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"详细地址"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.addressDetail))])]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"手机号码"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.phone))])]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"操作",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(i){e.updateAddress(t.row)}}},[e._v("修改")]),e._v(" "),i("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(i){e.deleteAddress(t.row.id)}}},[e._v("删除")]),e._v(" "),i("el-button",{attrs:{type:"primary",disabled:0===t.row.status,size:"mini"},nativeOn:{click:function(i){e.defaultAddress(t.row.id)}}},[e._v(e._s(0===t.row.status?"默认":"设为默认"))])]}}])})],1)],1)},staticRenderFns:[]};var d=i("VU/8")(l,o,!1,function(e){i("634l")},"data-v-5a94f395",null).exports,c=i("jYru"),v=i("EvBC"),u=i.n(v),f=i("78+T"),y=i.n(f),m={components:{DeliveryAddress:d,AdvertSelect:c.a},props:{activity:{type:Object}},data:function(){var e=this;return{listQuery:{current:1,size:20,condition:{user:this.$store.getters.userInfo.id}},rec:u.a,advertImg:y.a,pickerBeginDateBefore:{disabledDate:function(e){return e.getTime()<Date.now()}},deliveryAddressList:[],dialogDeliveryAddress:!1,rules:{name:[{required:!0,message:"请输入活动名称",trigger:"blur"}],startDate:[{required:!0,message:"请选择活动开始日期",trigger:"change"}],deliveryAddress:[{required:!0,message:"收货地址不能为空",trigger:"change"}],totalMoney:[{required:!0,validator:function(t,i,s){1!==e.activity.qrCount&&e.$refs.activity.validateField("minMoney"),i<e.activity.qrCount&&s(new Error("总金额不能小于红包个数")),s()},trigger:"blur"}],minMoney:[{required:!0,validator:function(t,i,s){i<=e.maxMinMoney&&s(),s(new Error("最小金额超出设置范围"))},trigger:"blur"}]},advert:""}},computed:{maxMinMoney:function(){return Math.floor(this.activity.totalMoney/this.activity.qrCount*100)/100}},created:function(){this.getDeliveryAddressList()},methods:{getDeliveryAddressList:function(e){var t=this;Object(a.j)(this.listQuery).then(function(i){var a=i.data;0===a.code&&"success"===a.msg&&(t.deliveryAddressList=a.datas.records,t.activity.deliveryAddress=Object(s.c)(a.datas.records),t.total=a.datas.total,e&&t.$refs.activity.validateField("deliveryAddress"),t.loading=!1)})},addDeliveryAddress:function(){this.dialogDeliveryAddress=!0},refreshAddress:function(){this.getDeliveryAddressList(!0)},minMoney_rule:function(e,t){return e===t?"设置范围：1":"设置范围：1～"+Math.floor(e/t*100)/100},checkInteger:function(e,t){var i=this.activity[t],s=this;this.$nextTick().then(function(){e%1!=0&&(s.activity[t]=i)})},checkSmallNumber:function(e,t){var i=this.activity[t],s=this;this.$nextTick().then(function(){/^\d+(\.\d{1,2})?$/.test(e)||(s.activity[t]=i)})},validateActivity:function(){var e=this;this.$refs.activity.validate(function(t){t?e.$emit("getChildValidMsg",!0):e.$emit("getChildValidMsg",!1)})}}},p={render:function(){var e=this,t=this,i=t.$createElement,s=t._self._c||i;return s("div",{staticClass:"activityForm"},[s("el-form",{ref:"activity",attrs:{model:t.activity,rules:t.rules,size:"small","label-width":"150px","label-position":"right"}},[s("div",{staticClass:"activityForm-main"},[s("div",{staticClass:"activityForm-main-title"},[s("svg-icon",{attrs:{"icon-class":"form"}}),t._v(" "),s("span",[t._v("现金红包")])],1),t._v(" "),s("div",{staticClass:"activityForm-main-item"},[s("el-form-item",{attrs:{label:"活动名称:",prop:"name"}},[s("el-col",{attrs:{span:9}},[s("el-input",{staticStyle:{width:"220px"},model:{value:t.activity.name,callback:function(e){t.$set(t.activity,"name",e)},expression:"activity.name"}})],1),t._v(" "),s("el-col",{attrs:{span:15}},[s("span",{staticClass:"form-item-span"})])],1),t._v(" "),s("el-form-item",{attrs:{label:"活动开始时间:",prop:"startDate"}},[s("el-col",{attrs:{span:9}},[s("el-date-picker",{attrs:{"picker-options":t.pickerBeginDateBefore,type:"datetime",placeholder:"选择日期时间"},model:{value:t.activity.startDate,callback:function(e){t.$set(t.activity,"startDate",e)},expression:"activity.startDate"}})],1),t._v(" "),s("el-col",{attrs:{span:15}},[t._v("二维码制作配送需要3～5天，建议提前5天发布活动信息")])],1),t._v(" "),s("el-form-item",{attrs:{label:"二维码收货地址:",prop:"deliveryAddress"}},[s("el-col",{attrs:{span:9}},[t._l(t.deliveryAddressList,function(e,i){return s("div",[s("el-radio",{attrs:{label:t._f("formatAddress")(e.address)+e.addressDetail+" ( "+e.receiver+" 收) "+e.phone},model:{value:t.activity.deliveryAddress,callback:function(e){t.$set(t.activity,"deliveryAddress",e)},expression:"activity.deliveryAddress"}},[t._v("\n                "+t._s(t._f("formatAddress")(e.address)+e.addressDetail+" ( "+e.receiver+" 收) "+e.phone)+"\n              ")])],1)}),t._v(" "),s("el-button",{attrs:{type:"text"},nativeOn:{click:function(e){t.addDeliveryAddress(e)}}},[t._v(t._s(t.deliveryAddressList.length>0?"管理收货地址":"添加收货地址"))])],2)],1),t._v(" "),s("el-form-item",{attrs:{label:"是否需要分享广告："}},[s("el-col",{attrs:{span:9}},[s("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949","active-value":0,"inactive-value":1},model:{value:t.activity.needShare,callback:function(e){t.$set(t.activity,"needShare",e)},expression:"activity.needShare"}}),t._v(" "),s("transition",{attrs:{name:"fade"}},[s("advert-select",{directives:[{name:"show",rawName:"v-show",value:!t.activity.needShare,expression:"!activity.needShare"}],model:{value:t.activity.advert,callback:function(e){t.$set(t.activity,"advert",e)},expression:"activity.advert"}})],1)],1)],1),t._v(" "),s("el-form-item",{attrs:{label:"限制扫码次数："}},[s("el-col",{attrs:{span:9}},[s("el-input-number",{attrs:{min:1},on:{change:function(e){t.checkInteger(e,"scanedTimes")}},model:{value:t.activity.scanedTimes,callback:function(e){t.$set(t.activity,"scanedTimes",e)},expression:"activity.scanedTimes"}})],1),t._v(" "),s("el-col",{attrs:{span:15}},[t._v("限制本次活动每个微信号可扫码的次数")])],1),t._v(" "),s("el-form-item",{attrs:{label:"二维码数(红包数)："}},[s("el-col",{attrs:{span:9}},[s("el-input-number",{attrs:{min:1,controls:!1},on:{blur:function(){1!==e.activity.qrCount&&e.$refs.activity.validateField("minMoney"),e.$refs.activity.validateField("totalMoney")},change:function(e){t.checkInteger(e,"qrCount")}},model:{value:t.activity.qrCount,callback:function(e){t.$set(t.activity,"qrCount",e)},expression:"activity.qrCount"}})],1),t._v(" "),s("el-col",{attrs:{span:15}},[t._v("一个二维码对应一个红包")])],1),t._v(" "),s("el-form-item",{attrs:{label:"红包总金额：",prop:"totalMoney"}},[s("el-col",{attrs:{span:9}},[s("el-input-number",{staticClass:"gold",attrs:{min:1,controls:!1},on:{change:function(e){t.checkSmallNumber(e,"totalMoney")}},model:{value:t.activity.totalMoney,callback:function(e){t.$set(t.activity,"totalMoney",e)},expression:"activity.totalMoney"}}),t._v(" "),s("span",{staticStyle:{color:"#4fc08d","font-size":"13px"}},[t._v("微信手续费："+t._s(t._f("mathCeil")(t.activity.totalMoney)))])],1),t._v(" "),s("el-col",{attrs:{span:15}},[t._v("微信限制，单个红包金额不能少于1元")])],1),t._v(" "),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:1!==t.activity.qrCount,expression:"activity.qrCount !== 1"}],attrs:{label:"最小金额：",prop:"minMoney"}},[s("el-col",{attrs:{span:9}},[s("el-input-number",{staticClass:"gold",attrs:{min:1,max:t.maxMinMoney,controls:!1},on:{change:function(e){t.checkSmallNumber(e,"minMoney")}},model:{value:t.activity.minMoney,callback:function(e){t.$set(t.activity,"minMoney",e)},expression:"activity.minMoney"}}),t._v(" "),s("span",{staticStyle:{color:"#4fc08d","font-size":"13px"}},[t._v(t._s(t.minMoney_rule(t.activity.totalMoney,t.activity.qrCount)))])],1),t._v(" "),s("el-col",{attrs:{span:15}},[t._v("设置不超过设置范围的数，可包含两位小数")])],1)],1)])]),t._v(" "),s("el-dialog",{attrs:{title:"管理收货地址",visible:t.dialogDeliveryAddress},on:{"update:visible":function(e){t.dialogDeliveryAddress=e},close:t.refreshAddress}},[t.dialogDeliveryAddress?s("delivery-address"):t._e()],1)],1)},staticRenderFns:[]};var g=i("VU/8")(m,p,!1,function(e){i("w1rV"),i("DQ7j")},"data-v-211ee57a",null);t.default=g.exports},TThK:function(e,t,i){(e.exports=i("FZ+f")(!1)).push([e.i,"\n.activityForm-main[data-v-211ee57a] {\n  display: table;\n  width: 100%;\n  background: #fff;\n  margin-bottom: 0;\n  padding: 40px 0 20px 0;\n  border-bottom: 1px solid #eee;\n}\n.activityForm-main-title[data-v-211ee57a] {\n    display: table-cell;\n    width: 160px;\n    padding: 0;\n    font-size: 14px;\n    font-weight: bold;\n    background: #fff;\n    color: #333;\n    text-align: center;\n    vertical-align: top;\n    position: relative;\n    top: 7px;\n}\n.activityForm-main .question-detail[data-v-211ee57a]:hover {\n    color: #4fc08d;\n    cursor: pointer;\n}\n.activityForm-main-item[data-v-211ee57a] {\n    display: table-cell;\n}\n.activityForm-main-delete[data-v-211ee57a] {\n    width: 160px;\n    text-align: center;\n}\n",""])},e1tw:function(e,t,i){(e.exports=i("FZ+f")(!1)).push([e.i,"\n.gold .el-input input {\n  color: #f90 !important;\n  font-weight: bolder !important;\n}\n",""])},w1rV:function(e,t,i){var s=i("TThK");"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);i("rjj0")("3199d4a2",s,!0)},y2Wv:function(e,t,i){(e.exports=i("FZ+f")(!1)).push([e.i,"\n.deliveryAddress-container[data-v-5a94f395] {\n  padding: 20px;\n}\n",""])}});